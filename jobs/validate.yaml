# Validates a deployed CDK

# V2 ------------------------------------------------------------------------- #
- job:
    name: 'validate-ck'
    node: runner-amd64
    description: |
      Validates CDK edge, supports last three recent releases.
    project-type: freestyle
    scm:
      - k8s-jenkins-jenkaas
    wrappers:
      - default-job-wrapper
      - ci-creds
    properties:
      - block-on-build-release
      - build-discarder:
          num-to-keep: 7
    triggers:
        - timed: "@daily"
    builders:
      - set-env:
          JOB_SPEC_DIR: "jobs/validate"
      - ogc-execute-spec:
          JOB_SPEC_DIR: "jobs/validate"
          JOB_SPEC_FILE: "spec.yml"
    publishers:
      - trigger:
          project: 'validate-ck-upgrade'
          threshold: SUCCESS

- job:
    name: 'validate-ck-upgrade'
    node: runner-amd64
    description: |
      Validates CDK minor release upgrades, supports last three recent releases.
    project-type: freestyle
    scm:
      - k8s-jenkins-jenkaas
    wrappers:
      - default-job-wrapper
      - ci-creds
    properties:
      - block-on-build-release
      - build-discarder:
          num-to-keep: 7
    builders:
      - set-env:
          JOB_SPEC_DIR: "jobs/validate"
      - ogc-execute-spec:
          JOB_SPEC_DIR: "jobs/validate"
          JOB_SPEC_FILE: "upgrade-spec.yml"
    publishers:
      - trigger:
          project: 'validate-ck-snapd-upgrade'
          threshold: SUCCESS


- job:
    name: 'validate-ck-snapd-upgrade'
    node: runner-amd64
    description: |
      Validates CK release using an upgrade snapcore.
    project-type: freestyle
    scm:
      - k8s-jenkins-jenkaas
    wrappers:
      - default-job-wrapper
      - ci-creds
    properties:
      - block-on-build-release
      - build-discarder:
          num-to-keep: 7
    builders:
      - set-env:
          JOB_SPEC_DIR: "jobs/validate"
      - ogc-execute-spec:
          JOB_SPEC_DIR: "jobs/validate"
          JOB_SPEC_FILE: "snapd-upgrade-spec.yml"
    publishers:
      - trigger:
          project: 'validate-ck-vault'
          threshold: SUCCESS


# ADDONS --------------------------------------------------------------------- #
- job:
    name: 'validate-ck-vault'
    node: runner-amd64
    description: |
      Validates CK, with vault.
    project-type: freestyle
    scm:
      - k8s-jenkins-jenkaas
    wrappers:
      - default-job-wrapper
      - ci-creds
    properties:
      - block-on-build-release
      - build-discarder:
          num-to-keep: 7
    builders:
      - set-env:
          JOB_SPEC_DIR: "jobs/validate"
      - ogc-execute-spec:
          JOB_SPEC_DIR: "jobs/validate"
          JOB_SPEC_FILE: "vault-spec.yml"
    publishers:
      - trigger:
          project: 'validate-ck-nvidia'
          threshold: SUCCESS

- job:
    name: 'validate-ck-nvidia'
    node: runner-amd64
    description: |
      Validates CK, with NVidia.
    project-type: freestyle
    scm:
      - k8s-jenkins-jenkaas
    wrappers:
      - default-job-wrapper
      - ci-creds
    properties:
      - block-on-build-release
      - build-discarder:
          num-to-keep: 7
    builders:
      - set-env:
          JOB_SPEC_DIR: "jobs/validate"
      - ogc-execute-spec:
          JOB_SPEC_DIR: "jobs/validate"
          JOB_SPEC_FILE: "nvidia-spec.yml"
    publishers:
      - trigger:
          project: 'validate-ck-ceph'
          threshold: SUCCESS


- job:
    name: 'validate-ck-ceph'
    node: runner-amd64
    description: |
      Validates CK, with Ceph.
    project-type: freestyle
    scm:
      - k8s-jenkins-jenkaas
    wrappers:
      - default-job-wrapper
      - ci-creds
    properties:
      - block-on-build-release
      - build-discarder:
          num-to-keep: 7
    builders:
      - set-env:
          JOB_SPEC_DIR: "jobs/validate"
      - ogc-execute-spec:
          JOB_SPEC_DIR: "jobs/validate"
          JOB_SPEC_FILE: "ceph-spec.yml"
    publishers:
      - trigger:
          project: 'validate-ck-tigera-secure-ee'
          threshold: SUCCESS

- job:
    name: 'validate-ck-tigera-secure-ee'
    description: |
      Validates CK, with tigera.
    node: runner-amd64
    project-type: freestyle
    scm:
      - k8s-jenkins-jenkaas
    wrappers:
      - default-job-wrapper
      - ci-creds
    properties:
      - block-on-build-release
      - build-discarder:
          num-to-keep: 7
    builders:
      - set-env:
          JOB_SPEC_DIR: "jobs/validate"
      - ogc-execute-spec:
          JOB_SPEC_DIR: "jobs/validate"
          JOB_SPEC_FILE: "tigera-ee-spec.yml"
    publishers:
      - trigger:
          project: 'validate-ck-calico'
          threshold: SUCCESS

- job:
    name: 'validate-ck-calico'
    description: |
      Validates CK, with calico.
    node: runner-amd64
    project-type: freestyle
    scm:
      - k8s-jenkins-jenkaas
    wrappers:
      - default-job-wrapper
      - ci-creds
    properties:
      - block-on-build-release
      - build-discarder:
          num-to-keep: 7
    builders:
      - set-env:
          JOB_SPEC_DIR: "jobs/validate"
      - ogc-execute-spec:
          JOB_SPEC_DIR: "jobs/validate"
          JOB_SPEC_FILE: "calico-spec.yml"


- job:
    name: 'validate-ck-aws-iam'
    description: |
      Validates CK, with AWS IAM.
    node: runner-amd64
    project-type: freestyle
    scm:
      - k8s-jenkins-jenkaas
    wrappers:
      - default-job-wrapper
      - ci-creds
    properties:
      - block-on-build-release
      - build-discarder:
          num-to-keep: 7
    triggers:
        - timed: "@daily"
    builders:
      - set-env:
          JOB_SPEC_DIR: "jobs/validate"
      - ogc-execute-spec:
          JOB_SPEC_DIR: "jobs/validate"
          JOB_SPEC_FILE: "aws-iam-spec.yml"
