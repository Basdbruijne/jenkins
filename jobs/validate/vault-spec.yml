plan:
  - &BASE_JOB
    env:
      - SNAP_VERSION=1.17/edge
      - JUJU_DEPLOY_BUNDLE=cs:~containers/charmed-kubernetes
      - JUJU_DEPLOY_CHANNEL=edge
      - JUJU_CLOUD=aws/us-east-1
      - JUJU_CONTROLLER=validate-ck-vault
      - JUJU_MODEL=validate-vault
    before-script:
      - juju kill-controller -y $JUJU_CONTROLLER || true
      - !include jobs/spec-helpers/bootstrap.yml
    script:
      - !include jobs/spec-helpers/pytest.yml
    after-script:
      - !include jobs/spec-helpers/collect.yml
      - juju destroy-controller -y --destroy-all-models --destroy-storage $JUJU_CONTROLLER
  - <<: *BASE_JOB
    env:
      - SNAP_VERSION=1.16/edge
      - JUJU_DEPLOY_BUNDLE=cs:~containers/charmed-kubernetes
      - JUJU_DEPLOY_CHANNEL=edge
      - JUJU_CLOUD=aws/us-east-1
      - JUJU_CONTROLLER=validate-ck-vault
      - JUJU_MODEL=validate-vault
  - <<: *BASE_JOB
    env:
      - SNAP_VERSION=1.16/stable
      - JUJU_DEPLOY_BUNDLE=cs:~containers/charmed-kubernetes
      - JUJU_DEPLOY_CHANNEL=edge
      - JUJU_CLOUD=aws/us-east-1
      - JUJU_CONTROLLER=validate-ck-vault
      - JUJU_MODEL=validate-vault
  # - <<: *BASE_JOB
  #   env:
  #     - SNAP_VERSION=1.15/edge
  #     - JUJU_DEPLOY_BUNDLE=cs:~containers/charmed-kubernetes
  #     - JUJU_DEPLOY_CHANNEL=edge
  #     - JUJU_CLOUD=aws/us-east-1
  #     - JUJU_CONTROLLER=validate-ck-vault
  #     - JUJU_MODEL=validate-vault
  # - <<: *BASE_JOB
  #   env:
  #     - SNAP_VERSION=1.14/edge
  #     - JUJU_DEPLOY_BUNDLE=cs:~containers/charmed-kubernetes
  #     - JUJU_DEPLOY_CHANNEL=edge
  #     - JUJU_CLOUD=aws/us-east-1
  #     - JUJU_CONTROLLER=validate-ck-vault
  #     - JUJU_MODEL=validate-vault

meta:
  name: Verify CK with Vault
  description: |
    Verifies that CK with Vault passes integration tests
  mkdocs:
    destination:
      - "validations/ck/vault.md"
    jenkins-job-builder:
      jobs:
        - jobs/ci-master.yaml
